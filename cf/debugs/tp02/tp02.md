# tp02

## Exo1

`\valid(<var>)` nous dis si la zone mémoire est correctement allouée.
`\valid_read(<var>)` nous dis que l'on peut y lire mais pas forcement y écrire.

`\old(...)` permet de faire référence explicitement à une valeur avant l’appel de la fonction.

1. Done.
2. Les gardes RTE indique que les pointeur peuvent ne pas être valid.

    ```c
    /*@
      requires \valid_read(a);
      requires \valid_read(b);
      ensures \result == *a || \result == *b;
      ensures \result >= *a;
      ensures \result >= *b;
    */
    ```

3. Done.

    ```c
    /*@
      requires \valid_read(a); // a[0]
      requires \valid_read(a+(int)(n-1)); // a[n-1]
      requires n > 0;
      requires a[0] + a[n-1] > INT_MIN;
      requires a[0] + a[n-1] < INT_MAX;
      ensures \result == a[0] + a[n-1];
    */
    ```

4. Done.

    ```c
    /*@
      requires \valid(a); // a[0]
      requires \valid(a+(int)(n-1)); // a[n-1]
      requires n > 0;
      ensures \old(a[0]) == a[n-1];
      ensures \old(a[n-1]) == a[0];
    */
    ```

    ```c
    /*@
      requires \valid(a);
      requires \valid(b);
      ensures \old(*a) == *b;
      ensures \old(*b) == *a;
    */
   ```

## Exo2

1. Done.

    ```c
    /*@
      requires \valid(a);
      requires \valid(b);
      ensures *a <= *b;
      ensures (\old(*a) == *a && \old(*b) == *b) || (\old(*a) == *b && \old(*b) == *a);
    */
    ```

2. Done.

    ```c
    /*@
      requires \valid(a);
      requires \valid_read(b);
      requires *a + *b >= INT_MIN;
      requires *a + *b <= INT_MAX;
      ensures *a == \old(*a) + \old(*b);
      ensures \old(*b) == *b;
    */
    ```

    Il n'arrive pas a prouver cette assertion car `a` et `b` peuvent pointer sur la même adresse.

3. Done.

    ```diff
    /*@
      requires \valid(a);
      requires \valid_read(b);
    +  requires \separated(a, b);
      requires *a + *b >= INT_MIN;
      requires *a + *b <= INT_MAX;
      ensures *a == \old(*a) + \old(*b);
      ensures \old(*b) == *b;
    */
    ```

## Exo3

1. Yes.
2. Done.

    ```diff
    /*@
      requires \valid(a);
      requires *a + 1 <= INT_MAX;
    +  assigns *a;
      ensures *a == \old(*a + 1);
    */
    void add_one(int *a);

    +/*@
    +  assigns \nothing;
    +*/
    void dummy();

    /*@
      requires \valid(a) && \valid(b);
      requires *a+1 <= INT_MAX;
    +  requires \separated(a, b);
      ensures \result == 1;
      ensures *a == \old(*a+1);
      ensures *b == \old(*b);
    */
    int f(int *a, int *b);
    ```

3. Car `a` et `b` peuvent pointer sur la même adresse.

## Exo4

1. Done.
2. Done.

    ```diff
    int writes(int *tab, int size, int index, int value){
    -  if(index <= size){
    +  if(index >= 0 && index < size){
        tab[index] = value;
        return 0;
      }
      return -1;
    }
    ```

## Exo5

1. `div()` and `add()` done and TODO: max_3_tab
